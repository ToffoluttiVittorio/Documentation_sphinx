<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation &mdash; Documentation Plateforme cartographique OLE </title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=d1a510d7"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script src="../_static/translations.js?v=041d0952"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Configuration" href="configuration.html" />
    <link rel="prev" title="Documentation d’installation" href="../doc_instal.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Plateforme cartographique OLE
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentations:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../doc_user.html">Documentation utilisateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc_admin.html">Documentation administrateur</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../doc_instal.html">Documentation d'installation</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ansible">Ansible</a></li>
<li class="toctree-l3"><a class="reference internal" href="#serveur-web">Serveur web</a></li>
<li class="toctree-l3"><a class="reference internal" href="#script-de-personnalisation">Script de personnalisation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="maj.html">Mise à jour</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Plateforme cartographique OLE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../doc_instal.html">Documentation d’installation</a></li>
      <li class="breadcrumb-item active">Installation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Lien vers cette rubrique"></a></h1>
<nav class="contents local" id="table-des-matieres">
<p class="topic-title">Table des matières</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p></li>
<li><p><a class="reference internal" href="#ansible" id="id2">Ansible</a></p></li>
<li><p><a class="reference internal" href="#serveur-web" id="id3">Serveur web</a></p></li>
<li><p><a class="reference internal" href="#script-de-personnalisation" id="id4">Script de personnalisation</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Lien vers cette rubrique"></a></h2>
<p>Georchestra est une IDG qui intègre plusieurs modules et donc plusieurs technologies, il y’a plusieurs façon d’installer cette infrastructure</p>
<ul class="simple">
<li><p>par docker</p></li>
<li><p>par Ansible</p></li>
<li><p>à la main</p></li>
</ul>
<p>Le choix pour l’Office de l’eau Réunion à été Ansible qui permet d’installer des paquets Debians rapidement et automatiquement.</p>
<p>Le lien pour le github de georchestra est le suivant : <a class="reference external" href="https://github.com/georchestra">https://github.com/georchestra</a></p>
</section>
<section id="ansible">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Ansible</a><a class="headerlink" href="#ansible" title="Lien vers cette rubrique"></a></h2>
<p>Prérequis :</p>
<ul class="simple">
<li><p>Debian Bookworm (12.x) VM</p></li>
<li><p>Ansible : sudo apt install ansible</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ansible
</pre></div>
</div>
<ul class="simple">
<li><p>Java 17 :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>openjdk-17-jdk
</pre></div>
</div>
<ul class="simple">
<li><p>Clone the source, le code est issue du repo « ansible » de georchestra :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/ToffoluttiVittorio/ansible.git
</pre></div>
</div>
<ul class="simple">
<li><p>Installer les rôles de GeoNetwork :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>ansible-galaxy<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.yaml
sudo<span class="w"> </span>chmod<span class="w"> </span>-777<span class="w"> </span>chemin/vers/ansible/roles/
</pre></div>
</div>
<ul class="simple">
<li><p>Ajouter les clés manquantes :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-key<span class="w"> </span>adv<span class="w"> </span>--keyserver<span class="w"> </span>keyserver.ubuntu.com<span class="w"> </span>--recv-keys<span class="w"> </span>0E98404D386FA1D9
sudo<span class="w"> </span>apt-key<span class="w"> </span>adv<span class="w"> </span>--keyserver<span class="w"> </span>keyserver.ubuntu.com<span class="w"> </span>--recv-keys<span class="w"> </span>6ED0E7B82643E131
sudo<span class="w"> </span>apt-key<span class="w"> </span>adv<span class="w"> </span>--keyserver<span class="w"> </span>keyserver.ubuntu.com<span class="w"> </span>--recv-keys<span class="w"> </span>605C66F00D6C9793
</pre></div>
</div>
<ul class="simple">
<li><p>Run the playbook for ansible :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>ansible-playbook<span class="w"> </span>playbooks/georchestra.yml
</pre></div>
</div>
<p>L’installation de l’infrastructure de geOrchestra et faite, il reste à installer un serveur de mail et les scripts de personnalisation pour avoir
l’application fonctionnel et complète pour l’Office de l’eau Réunion.</p>
</section>
<section id="serveur-web">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Serveur web</a><a class="headerlink" href="#serveur-web" title="Lien vers cette rubrique"></a></h2>
<p>Pour le serveur web, pour l’instant un postfix est installé :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>postfix
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>postfix.service
</pre></div>
</div>
<p>avec cette configuration dans le fichier /etc/postfix/main.cf :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">smtpd_relay_restrictions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>permit_mynetworks<span class="w"> </span>permit_sasl_authenticated<span class="w"> </span>defer_unauth_destination
<span class="nv">myhostname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Ansible-42.myguest.virtualbox.org
<span class="nv">alias_maps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>hash:/etc/aliases
<span class="nv">alias_database</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>hash:/etc/aliases
<span class="nv">mydestination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$myhostname</span>,<span class="w"> </span>localhost,<span class="w"> </span>localhost.<span class="nv">$mydomain</span>,<span class="w"> </span>mail.<span class="nv">$mydomain</span>,<span class="w"> </span>www.<span class="nv">$mydomain</span>,<span class="w"> </span>localhost,<span class="w"> </span><span class="nv">$mydomain</span>
<span class="nv">relayhost</span><span class="w"> </span><span class="o">=</span>
<span class="nv">mynetworks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">127</span>.0.0.0/8<span class="w"> </span><span class="o">[</span>::ffff:127.0.0.0<span class="o">]</span>/104<span class="w"> </span><span class="o">[</span>::1<span class="o">]</span>/128
<span class="nv">mailbox_size_limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="nv">recipient_delimiter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>+
<span class="nv">inet_interfaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>all
<span class="nv">inet_protocols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>all
</pre></div>
</div>
</section>
<section id="script-de-personnalisation">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Script de personnalisation</a><a class="headerlink" href="#script-de-personnalisation" title="Lien vers cette rubrique"></a></h2>
<p>Les scripts de personnalisation servent à ajouter les spécifications pour l’Office de l’eau Réunion sans directement changer le code d’installation.</p>
<p>Il y’a trois script bash qui modifient les logos, couleurs et référentiel de coordonée dans le dossier « Configuration » :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># Mise à jour du fichier de propriétés pour le changement de langue</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de &#39;language=en&#39; par &#39;language=fr&#39; dans le fichier de propriétés...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/language=en/language=fr/&#39;</span><span class="w"> </span>/etc/georchestra/default.properties
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour du fichier de propriétés terminée.&quot;</span>

<span class="c1"># Mise à jour du fichier de propriétés pour le changement d&#39;URL du logo</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de l&#39;URL du logo dans le fichier de propriétés...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s|logoUrl=https://www.georchestra.org/public/georchestra-logo.svg|logoUrl=https://raw.githubusercontent.com/ToffoluttiVittorio/ansible/master/Configuration/georchestra-logo.svg|&#39;</span><span class="w"> </span>/etc/georchestra/default.properties
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour de l&#39;URL du logo terminée.&quot;</span>

<span class="c1"># Remplacement de l&#39;URL de la feuille de style commentée dans le fichier de propriétés</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de l&#39;URL de la feuille de style commentée dans le fichier de propriétés...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s|# georchestraStylesheet=http://my-domain-name/stylesheet.css|georchestraStylesheet=./stylesheet.css|&#39;</span><span class="w"> </span>/etc/georchestra/default.properties
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour de l&#39;URL de la feuille de style terminée.&quot;</span>

<span class="c1"># Activation des analytics dans le fichier de propriétés</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Activation des analytics dans le fichier de propriétés...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/analyticsEnabled=false/analyticsEnabled=true/&#39;</span><span class="w"> </span>/etc/georchestra/default.properties
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Activation des analytics terminée.&quot;</span>

<span class="c1"># Mise à jour de la timezone dans le fichier de propriétés</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de la timezone dans le fichier de propriétés...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s|#localTimezone=Europe/Paris|localTimezone=Indian/Reunion|&#39;</span><span class="w"> </span>/etc/georchestra/analytics/analytics.properties
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour de la timezone terminée.&quot;</span>

<span class="c1"># Traduction des valeurs de orgTypeValues dans le fichier de propriétés</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement des valeurs de orgTypeValues par leur traduction en français...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/orgTypeValues=Association,Company,NGO,Individual,Other/orgTypeValues=Association,Entreprise,ONG,Individu,Autre/&#39;</span><span class="w"> </span>/etc/georchestra/console/console.properties
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Traduction des valeurs de orgTypeValues terminée.&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># Vérifier si la nouvelle projection existe déjà dans le fichier JSON et ajouter si elle n&#39;existe pas</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Vérification et ajout de la nouvelle entrée à la liste &#39;projections&#39; dans le fichier JSON...&quot;</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s1">&#39;&quot;value&quot;: &quot;EPSG:2975&quot;&#39;</span><span class="w"> </span>/etc/georchestra/datafeeder/frontend-config.json<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/&quot;projections&quot;: \[/a \</span>
<span class="s1">   {\</span>
<span class="s1">      &quot;label&quot;: &quot;RGR92 / UTM zone 40S&quot;,\</span>
<span class="s1">      &quot;value&quot;: &quot;EPSG:2975&quot;\</span>
<span class="s1">   },&#39;</span><span class="w"> </span>/etc/georchestra/datafeeder/frontend-config.json
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Nouvelle entrée ajoutée à la liste &#39;projections&#39;.&quot;</span>
<span class="k">else</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;La projection &#39;EPSG:2975&#39; existe déjà dans la liste &#39;projections&#39;.&quot;</span>
<span class="k">fi</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour du fichier JSON terminée.&quot;</span>

<span class="c1"># Remplacement des valeurs dans le fichier XML</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de &#39;codeListValue=\&quot;eng\&quot;&#39; par &#39;codeListValue=\&quot;fre\&quot;&#39; dans le fichier XML de datafeeder&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/codeListValue=&quot;eng&quot;/codeListValue=&quot;fre&quot;/g&#39;</span><span class="w"> </span>/etc/georchestra/datafeeder/metadata_template.xml
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement dans le fichier XML terminé.&quot;</span>

<span class="c1"># Suppression du fichier header_bg.web et copie du fichier header_bg.webp</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Suppression du fichier header_bg.web et copie du fichier header_bg.webp...&quot;</span>
rm<span class="w"> </span>-f<span class="w"> </span>/etc/georchestra/datahub/assets/img/header_bg.web
cp<span class="w"> </span>header_bg.webp<span class="w"> </span>/etc/georchestra/datahub/assets/img/
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Fichier header_bg.web remplacé par header_bg.webp.&quot;</span>

<span class="c1"># Remplacement dans le fichier TOML pour les langues</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de &#39;# languages = [&#39;en&#39;, &#39;fr&#39;, &#39;de&#39;]&#39; par &#39;languages = [&#39;en&#39;, &#39;fr&#39;, &#39;de&#39;]&#39; dans le fichier TOML...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s/# languages = \[&#39;en&#39;, &#39;fr&#39;, &#39;de&#39;\]/languages = \[&#39;en&#39;, &#39;fr&#39;, &#39;de&#39;\]/&quot;</span><span class="w"> </span>/etc/georchestra/datahub/conf/default.toml
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement dans le fichier TOML terminé.&quot;</span>

<span class="c1"># Remplacement de la couleur primaire dans le fichier TOML</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de &#39;primary_color = \&quot;#85127e\&quot;&#39; par &#39;primary_color = \&quot;#0a397f\&quot;&#39; dans le fichier TOML...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/primary_color = &quot;#85127e&quot;/primary_color = &quot;#0a397f&quot;/&#39;</span><span class="w"> </span>/etc/georchestra/datahub/conf/default.toml
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de la couleur primaire dans le fichier TOML terminé.&quot;</span>

<span class="c1"># Remplacement de la couleur secondaire dans le fichier TOML</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de &#39;secondary_color = \&quot;#1b1f3b\&quot;&#39; par &#39;secondary_color = \&quot;#225ea8\&quot;&#39; dans le fichier TOML...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/secondary_color = &quot;#1b1f3b&quot;/secondary_color = &quot;#225ea8&quot;/&#39;</span><span class="w"> </span>/etc/georchestra/datahub/conf/default.toml
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de la couleur secondaire dans le fichier TOML terminé.&quot;</span>

<span class="c1"># Suppression du commentaire et activation de la ligne dans le fichier TOML</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de &#39;# enabled = true&#39; par &#39;enabled = true&#39; pour activer le % de qualité de métadonnée&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/# enabled = true/enabled = true/&#39;</span><span class="w"> </span>/etc/georchestra/datahub/conf/default.toml
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Activation de la ligne dans le fichier TOML terminée.&quot;</span>

<span class="c1"># Suppression des sections &#39;en&#39; et &#39;it&#39; dans le fichier JSON</span>
<span class="c1">#echo &quot;Suppression des sections &#39;en&#39; et &#39;it&#39; dans le fichier JSON...&quot;</span>
<span class="c1">#sed -i &#39;/&quot;en&quot;: {/,/},/d&#39; /etc/georchestra/mapstore/configs/localConfig.json</span>
<span class="c1">#sed -i &#39;/&quot;it&quot;: {/,/},/d&#39; /etc/georchestra/mapstore/configs/localConfig.json</span>
<span class="c1">#echo &quot;Suppression des sections terminée.&quot;</span>

<span class="c1"># Vérifier si la nouvelle projection existe déjà dans la section &#39;projectionDefs&#39; et ajouter si elle n&#39;existe pas</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Vérification et ajout de la nouvelle projection à la section &#39;projectionDefs&#39;...&quot;</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s1">&#39;&quot;code&quot;: &quot;EPSG:2975&quot;&#39;</span><span class="w"> </span>/etc/georchestra/mapstore/configs/localConfig.json<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/&quot;projectionDefs&quot;: \[/a \</span>
<span class="s1">      &quot;code&quot;: &quot;EPSG:2975&quot;,\</span>
<span class="s1">      &quot;def&quot;: &quot;+proj=lcc +lat_1=48.5 +lat_2=49.5 +lat_0=48.0 +lon_0=-123.0 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs&quot;,\</span>
<span class="s1">      &quot;extent&quot;: [-600000, 1500000, 1200000, 5000000],\</span>
<span class="s1">      &quot;worldExtent&quot;: [-130, 24, -66, 49]\</span>
<span class="s1">   },{&#39;</span><span class="w"> </span>/etc/georchestra/mapstore/configs/localConfig.json
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Nouvelle projection ajoutée à la section &#39;projectionDefs&#39;.&quot;</span>
<span class="k">else</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;La projection &#39;EPSG:2975&#39; existe déjà dans la section &#39;projectionDefs&#39;.&quot;</span>
<span class="k">fi</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour du fichier terminé.&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># Copier le fichier stylesheet.css dans les répertoires de destination</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Copie du fichier stylesheet.css dans les répertoires de destination...&quot;</span>

<span class="c1"># Répertoires de destination</span>
<span class="nv">DESTINATIONS</span><span class="o">=(</span>
<span class="s2">&quot;/var/www/georchestra/htdocs/datahub/&quot;</span>
<span class="s2">&quot;/srv/tomcat/georchestra/webapps/analytics/&quot;</span>
<span class="s2">&quot;/srv/tomcat/proxycas/webapps/cas/WEB-INF/classes/static/&quot;</span>
<span class="s2">&quot;/srv/tomcat/georchestra/webapps/console/account/&quot;</span>
<span class="o">)</span>

<span class="c1"># Boucle pour copier le fichier dans chaque répertoire</span>
<span class="k">for</span><span class="w"> </span>DEST<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DESTINATIONS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
cp<span class="w"> </span>./stylesheet.css<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DEST</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Fichier stylesheet.css copié avec succès dans </span><span class="nv">$DEST</span><span class="s2">.&quot;</span>
<span class="k">done</span>

<span class="c1"># Remplacement des couleurs dans le fichier CSS</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement des couleurs dans le fichier cas.css&quot;</span>
<span class="c1"># Remplacer #540069 par #0a397f</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#540069/#0a397f/g&#39;</span><span class="w"> </span><span class="s2">&quot;/srv/tomcat/proxycas/webapps/cas/WEB-INF/classes/static/themes/georchestra/css/cas.css&quot;</span>
<span class="c1"># Remplacer #720e9e par #0a397f</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#720e9e/#0a397f/g&#39;</span><span class="w"> </span><span class="s2">&quot;/srv/tomcat/proxycas/webapps/cas/WEB-INF/classes/static/themes/georchestra/css/cas.css&quot;</span>
<span class="c1"># Remplacer #845490 par #225ea8</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#845490/#225ea8/g&#39;</span><span class="w"> </span><span class="s2">&quot;/srv/tomcat/proxycas/webapps/cas/WEB-INF/classes/static/themes/georchestra/css/cas.css&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement des couleurs terminé.&quot;</span>

<span class="c1"># Remplacement des valeurs de langue dans le fichier JSP</span>
<span class="c1">#echo &quot;Remplacement des valeurs de langue dans le fichier JSP...&quot;</span>

<span class="c1"># Remplacer lang = forcedLang par lang = &quot;fr&quot;</span>
<span class="c1">#sed -i &#39;s/lang = forcedLang/lang = &quot;fr&quot;/g&#39; &quot;/srv/tomcat/georchestra/webapps/analytics/WEB-INF/jsp/index.jsp&quot;</span>

<span class="c1"># Remplacer lang = detectedLanguage par lang = &quot;fr&quot;</span>
<span class="c1">#sed -i &#39;s/lang = detectedLanguage/lang = &quot;fr&quot;/g&#39; &quot;/srv/tomcat/georchestra/webapps/analytics/WEB-INF/jsp/index.jsp&quot;</span>

<span class="c1">#echo &quot;Remplacement des valeurs de langue terminé.&quot;</span>

<span class="c1"># Changement de couleurs dans le css de mapstore</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Changement de couleurs dans le css de mapstore&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#85127e/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Changement de couleurs dans le css de mapstore terminé.&quot;</span>


<span class="c1"># Changement du header de datahub</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Changement du header de datahub&quot;</span>
<span class="c1"># Chemin vers votre fichier HTML</span>
<span class="nv">file</span><span class="o">=</span><span class="s2">&quot;/var/www/georchestra/htdocs/datahub/index.html&quot;</span>

<span class="c1"># Attributs à vérifier</span>
<span class="nv">attr_check</span><span class="o">=</span><span class="s2">&quot;lang=&#39;fr&#39; stylesheet=&#39;./stylesheet.css&#39; logo-url=&#39;./georchestra-logo.svg&#39;&quot;</span>

<span class="c1"># Vérifier si la balise &lt;geor-header&gt; avec les attributs existe déjà</span>
<span class="k">if</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;&lt;geor-header.*</span><span class="nv">$attr_check</span><span class="s2">.*&gt;&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Les attributs existent déjà dans la balise &lt;geor-header&gt;.&quot;</span>
<span class="k">else</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Les attributs n&#39;existent pas. Ajout en cours...&quot;</span>
<span class="c1"># Commande sed pour ajouter les attributs</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s/&lt;geor-header active-app=&#39;datahub&#39; legacy-header=&#39;false&#39; legacy-url=&#39;\/header\/&#39; style=&#39;height:90px&#39;&gt;/&lt;geor-header active-app=&#39;datahub&#39; legacy-header=&#39;false&#39; legacy-url=&#39;\/header\/&#39; lang=&#39;fr&#39; stylesheet=&#39;.\/stylesheet.css&#39; logo-url=&#39;.\/georchestra-logo.svg&#39; style=&#39;height:90px&#39;&gt;/g&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Les attributs ont été ajoutés.&quot;</span>
<span class="k">fi</span>

<span class="c1">#Ajout du logo pour le header de datahub</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Ajout du logo pour le header de datahub&quot;</span>
cp<span class="w"> </span>./georchestra-logo.svg<span class="w"> </span>/var/www/georchestra/htdocs/datahub/
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Ajout du logo pour le header de mapstore terminé&quot;</span>

<span class="c1">#Changement du favicon</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement du favicon&quot;</span>
rm<span class="w"> </span>/var/www/georchestra/htdocs/favicon.ico
cp<span class="w"> </span>./favicon.ico<span class="w"> </span>/var/www/georchestra/htdocs/favicon.ico
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Ramplacement du favicon&quot;</span>

<span class="c1">#Changement des couleurs de mapstore</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Changement des couleurs pour mapstore&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#6f0f69/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#ed76e5/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#df1ed3/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#708/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#d97fff/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#6e296a/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#800080/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#b218a9/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#610/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#d5c/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#8e1387/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#7c1175/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#42093e/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#150314/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#390836/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#4f0b46/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#680c63/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#73106d/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#73106d/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Changement des couleur terminés&quot;</span>

<span class="c1"># Copie du favicon.png dans le repertoire de geonetwork</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Copie du favicon.png dans le repertoire de geonetwork&quot;</span>
cp<span class="w"> </span>./favicon.png<span class="w"> </span>/srv/data/geonetwork/data/resources/images/logos/
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Copie du favicon.png dans le repertoire de geonetwork terminé&quot;</span>

<span class="c1"># Vérification et ajout des redirections</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Vérification des redirections&quot;</span>

<span class="c1"># Vérifiez si le pattern existe déjà dans le fichier</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s1">&#39;Redirect the stylesheet&#39;</span><span class="w"> </span>/etc/nginx/sites-available/georchestra<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span><span class="c1"># Ajouter les redirections juste avant la dernière occurrence du pattern spécifique</span>
<span class="w">   </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/# redirect default to datahub/i \</span>
<span class="s1">      # Redirect the stylesheet.css url of geoserver to something known\</span>
<span class="s1">      location /geoserver/web/wicket/bookmarkable/stylesheet.css {\</span>
<span class="s1">            alias /etc/georchestra/stylesheet.css;\</span>
<span class="s1">      }\</span>
<span class="s1">      # Same for another url\</span>
<span class="s1">      location /geoserver/web/stylesheet.css {\</span>
<span class="s1">            alias /etc/georchestra/stylesheet.css;\</span>
<span class="s1">      }\</span>
<span class="s1">      # Redirect the stylesheet.css url of geonetwork to something known\</span>
<span class="s1">      location ~ ^/geonetwork/.*/.*/stylesheet\\.css$ {\</span>
<span class="s1">            alias /etc/georchestra/stylesheet.css;\</span>
<span class="s1">      }\</span>
<span class="s1">      # Redirect the stylesheet.css of the console admin account url to something known\</span>
<span class="s1">      location /console/account/stylesheet.css {\</span>
<span class="s1">            alias /etc/georchestra/stylesheet.css;\</span>
<span class="s1">      }\</span>
<span class="s1">      # Redirect the stylesheet.css of the console admin manager url to something known\</span>
<span class="s1">      location /console/manager/stylesheet.css {\</span>
<span class="s1">            alias /etc/georchestra/stylesheet.css;\</span>
<span class="s1">      }\</span>
<span class="s1">      &#39;</span><span class="w"> </span>/etc/nginx/sites-available/georchestra

<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Les redirections ont été ajoutées&quot;</span>
<span class="k">else</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Les redirections ont déjà été ajoutées&quot;</span>
<span class="k">fi</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour des redirections terminée.&quot;</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="../doc_instal.html" class="btn btn-neutral float-left" title="Documentation d’installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="configuration.html" class="btn btn-neutral float-right" title="Configuration" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2024, Vittorio Toffolutti.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>