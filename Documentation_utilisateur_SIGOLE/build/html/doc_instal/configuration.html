<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuration &mdash; Documentation Plateforme cartographique OLE </title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=d1a510d7"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script src="../_static/translations.js?v=041d0952"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Mise à jour" href="maj.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Plateforme cartographique OLE
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../doc_user.html">Documentation utilisateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc_admin.html">Documentation administrateur</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../doc_instal.html">Documentation d'installation - Développeur</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#localisation-des-differents-repertoires">Localisation des différents répertoires</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fichiers-de-configuration-du-datadir">Fichiers de configuration du datadir</a></li>
<li class="toctree-l3"><a class="reference internal" href="#versionnement-des-modules">Versionnement des modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#base-de-donnee">Base de donnée</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scripts-de-personnalisation">Scripts de personnalisation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="maj.html">Mise à jour</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Plateforme cartographique OLE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../doc_instal.html">Documentation d’installation - Développeur</a></li>
      <li class="breadcrumb-item active">Configuration</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Lien vers cette rubrique"></a></h1>
<nav class="contents local" id="table-des-matieres">
<p class="topic-title">Table des matières</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p></li>
<li><p><a class="reference internal" href="#localisation-des-differents-repertoires" id="id2">Localisation des différents répertoires</a></p></li>
<li><p><a class="reference internal" href="#fichiers-de-configuration-du-datadir" id="id3">Fichiers de configuration du datadir</a></p></li>
<li><p><a class="reference internal" href="#versionnement-des-modules" id="id4">Versionnement des modules</a></p></li>
<li><p><a class="reference internal" href="#base-de-donnee" id="id5">Base de donnée</a></p></li>
<li><p><a class="reference internal" href="#scripts-de-personnalisation" id="id6">Scripts de personnalisation</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Lien vers cette rubrique"></a></h2>
<p>Le code étant très dense et compilé, il faudra comprendre la structure et les fichiers de configuration mis à dispostion plutôt que le code en profondeur.</p>
</section>
<section id="localisation-des-differents-repertoires">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Localisation des différents répertoires</a><a class="headerlink" href="#localisation-des-differents-repertoires" title="Lien vers cette rubrique"></a></h2>
<p>Les logs des différents modules sont dans : <code class="docutils literal notranslate"><span class="pre">/srv/log/</span></code></p>
<p>Les binaires et le code source sont divisée en trois :
- <code class="docutils literal notranslate"><span class="pre">/srv/tomcat/georchestra/webapps</span></code> pour les modules analytics, console, geonetwork, geowebcache, header, import, mapstore
- <code class="docutils literal notranslate"><span class="pre">/srv/tomcat/geoserver/webapps</span></code> pour le module geoserver
- <code class="docutils literal notranslate"><span class="pre">/srv/tomcat/proxycas/webapps</span></code> pour les modules cas et ROOT</p>
<p>Les données de geonetwork et geoserver sont dans le repertoire : <code class="docutils literal notranslate"><span class="pre">/srv/data/</span></code></p>
<p>Les pages web statiques sont dans : <code class="docutils literal notranslate"><span class="pre">/var/www/georchestra/htdocs/</span></code></p>
<p>Le module nginx est lui dans : <code class="docutils literal notranslate"><span class="pre">/etc/nginx/</span></code></p>
<p>Les dossiers de configuration se trouve dans : <code class="docutils literal notranslate"><span class="pre">/etc/georchestra/</span></code></p>
</section>
<section id="fichiers-de-configuration-du-datadir">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Fichiers de configuration du datadir</a><a class="headerlink" href="#fichiers-de-configuration-du-datadir" title="Lien vers cette rubrique"></a></h2>
<p>GeOrchestra possèdent un « datadir » qui est un repertoire de fichiers de configuration qui sert à modifier rapidement certaines configurations.
Il se situe dans : <code class="docutils literal notranslate"><span class="pre">/etc/georchestra</span></code>
Il faut ensuite naviguer dans les différents répertoies pour modifier la configuration de chaque module.</p>
<p>Les paramètres généraux peuvent être modfiées dans le fichier <code class="docutils literal notranslate"><span class="pre">/etc/georchestra/default.properties</span></code> où il est possible de modifier :
- le logo
- le style du header
- les paramètre de postgresql
- les paramètre du ldap
- les paramètres du rabittmq
- les paramètres SMTP</p>
<p>Ensuite il faut naviguer dans les différents sous-répertoire pour modifier spécifiquement les configs, voici le lien
de la documentation qui explique cela plus en détails : <a class="reference external" href="https://github.com/georchestra/datadir">https://github.com/georchestra/datadir</a></p>
</section>
<section id="versionnement-des-modules">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Versionnement des modules</a><a class="headerlink" href="#versionnement-des-modules" title="Lien vers cette rubrique"></a></h2>
<p>Le versionnement s’effectue dans le fichier issue du clone du repo git <code class="docutils literal notranslate"><span class="pre">ansible/playbooks/georchestra.yml</span></code> qui est le fichier qui va spécifier les versions et les modules à installer
lors du lancement de l’installation.</p>
<p>Ce fichier sert à configurer : les versions, les chemins, les ports, les modules …</p>
<p>Il est très simple à lire et comprendre :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>---
-<span class="w"> </span>name:<span class="w"> </span>georchestra<span class="w"> </span>deployment
hosts:<span class="w"> </span>localhost
<span class="c1"># note: above host must match the content of the &quot;hosts&quot; file</span>
become:<span class="w"> </span><span class="nb">true</span>
roles:
<span class="w">   </span>-<span class="w"> </span><span class="o">{</span><span class="w"> </span>role:<span class="w"> </span>georchestra,<span class="w"> </span>tags:<span class="w"> </span>georchestra<span class="w"> </span><span class="o">}</span>
<span class="w">   </span>-<span class="w"> </span><span class="o">{</span><span class="w"> </span>role:<span class="w"> </span>elastic.elasticsearch,<span class="w"> </span>tags:<span class="w"> </span>es<span class="w"> </span><span class="o">}</span>
<span class="w">   </span>-<span class="w"> </span><span class="o">{</span><span class="w"> </span>role:<span class="w"> </span>geerlingguy.kibana,<span class="w"> </span>tags:<span class="w"> </span>kibana<span class="w"> </span><span class="o">}</span>

vars:

<span class="w">   </span>georchestra_versions:
<span class="w">      </span><span class="c1"># master version</span>
<span class="w">      </span><span class="c1"># datadir: 24.0 # or, see https://github.com/georchestra/datadir/branches</span>
<span class="w">      </span><span class="c1"># debian_repository_url: deb [signed-by=/etc/apt/keyrings/packages.georchestra.org.gpg] https://packages.georchestra.org/debian master main # or 24.0.x</span>
<span class="w">      </span><span class="c1"># georchestra_repository: 24.0.x # see https://github.com/georchestra/georchestra/branches</span>
<span class="w">      </span><span class="c1"># geonetwork_datadir: gn4.2.7 # see https://github.com/georchestra/geonetwork_minimal_datadir/branches</span>
<span class="w">      </span><span class="c1"># geoserver_datadir: 2.25.0 # https://github.com/georchestra/geoserver_minimal_datadir/branches</span>
<span class="w">      </span><span class="c1"># 24.0.x</span>

<span class="w">      </span>datadir:<span class="w"> </span><span class="s2">&quot;24.0&quot;</span>
<span class="w">      </span>debian_repository_url:<span class="w"> </span><span class="s2">&quot;deb [signed-by=/etc/apt/keyrings/packages.georchestra.org.gpg] https://packages.georchestra.org/debian 24.0.x main&quot;</span>
<span class="w">      </span>georchestra_repository:<span class="w"> </span><span class="s2">&quot;24.0.x&quot;</span>
<span class="w">      </span>geonetwork_datadir:<span class="w"> </span><span class="s2">&quot;gn4.2.7&quot;</span>
<span class="w">      </span>geoserver_datadir:<span class="w"> </span><span class="s2">&quot;24.0&quot;</span>


<span class="w">   </span>java_version:<span class="w"> </span>java-17-openjdk-amd64
<span class="w">   </span>tomcat_version:<span class="w"> </span><span class="m">9</span>
<span class="w">   </span>kibana_server_host:<span class="w"> </span><span class="m">127</span>.0.0.1
<span class="w">   </span>es_version:<span class="w"> </span><span class="m">7</span>.17.22
<span class="w">   </span>es_data_dirs:
<span class="w">      </span>-<span class="w"> </span>/srv/elasticsearch/data
<span class="w">   </span>es_log_dir:<span class="w"> </span>/srv/elasticsearch/logs
<span class="w">   </span>es_config:
<span class="w">      </span>cluster.name:<span class="w"> </span><span class="s2">&quot;{{ georchestra.fqdn }}&quot;</span>
<span class="w">      </span>bootstrap.memory_lock:<span class="w"> </span><span class="nb">true</span>
<span class="w">   </span>es_heap_size:<span class="w"> </span>1g
<span class="w">   </span>cadastrapp:
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">false</span>
<span class="w">      </span>db:
<span class="w">      </span>name:<span class="w"> </span>georchestra
<span class="w">      </span>user:<span class="w"> </span>georchestra
<span class="w">      </span>schema:<span class="w"> </span>cadastrapp
<span class="w">      </span>pass:<span class="w"> </span>georchestra
<span class="w">      </span>qgisdb:
<span class="w">      </span>host:<span class="w"> </span>localhost
<span class="w">      </span>port:<span class="w"> </span><span class="m">5432</span>
<span class="w">      </span>name:<span class="w"> </span>georchestra
<span class="w">      </span>user:<span class="w"> </span>georchestra
<span class="w">      </span>pass:<span class="w"> </span>georchestra
<span class="w">      </span>schema:<span class="w"> </span>qadastre
<span class="w">      </span>gitrepo:<span class="w"> </span>https://github.com/georchestra/cadastrapp
<span class="w">      </span>gitversion:<span class="w"> </span>master
<span class="w">      </span>debsrc:
<span class="w">      </span>path:<span class="w"> </span>/data/src/georchestra/cadastrapp/cadastrapp/target/
<span class="w">      </span>pkg:<span class="w"> </span>georchestra-cadastrapp_99.master.202108020909~80b14a6-1_all.deb
<span class="w">      </span>host:<span class="w"> </span>build.fluela
<span class="w">      </span>workdir:<span class="w"> </span>/tmp/cadastrapp/tmp
<span class="w">   </span><span class="c1"># Set here your Github token, which should at least have the &#39;actions&#39; scope</span>
<span class="w">   </span>github_action_token:<span class="w"> </span>secret
<span class="w">   </span><span class="c1"># if deploying an ms2 artifact from gh</span>
<span class="w">   </span><span class="c1"># mapstore: {</span>
<span class="w">   </span><span class="c1">#  enabled: True,</span>
<span class="w">   </span><span class="c1">#  repo: georchestra/mapstore2-georchestra,</span>
<span class="w">   </span><span class="c1">#  artifact_id: 119135632,</span>
<span class="w">   </span><span class="c1">#  artifact_sha256: b2803ecc76a3768fdc5e358f23b5c5ce10b02ddc #git commit hash</span>
<span class="w">   </span><span class="c1"># }</span>
<span class="w">   </span>openldap:
<span class="w">      </span>topdc:<span class="w"> </span>georchestra
<span class="w">      </span>basedn:<span class="w"> </span><span class="nv">dc</span><span class="o">=</span>georchestra,dc<span class="o">=</span>org<span class="w"> </span><span class="c1"># has to be in the form dc={{ topdc }},dc=xx</span>
<span class="w">      </span>rootdn:<span class="w"> </span><span class="nv">cn</span><span class="o">=</span>admin,dc<span class="o">=</span>georchestra,dc<span class="o">=</span>org
<span class="w">      </span>rootpw:<span class="w"> </span>secret
<span class="w">      </span>gitrepo:<span class="w"> </span>https://raw.github.com/georchestra/georchestra
<span class="w">      </span>ldifs:
<span class="w">      </span>-<span class="w"> </span>bootstrap
<span class="w">      </span>-<span class="w"> </span>docker-root/georchestraSchema
<span class="w">      </span>-<span class="w"> </span>docker-root/etc/ldap.dist/modules/groupofmembers
<span class="w">      </span>-<span class="w"> </span>docker-root/etc/ldap.dist/modules/openssh
<span class="w">      </span>-<span class="w"> </span>docker-root/memberof
<span class="w">      </span>-<span class="w"> </span>docker-root/lastbind
<span class="w">      </span>-<span class="w"> </span>root
<span class="w">      </span>-<span class="w"> </span>docker-root/georchestra
<span class="w">      </span>gitversion:<span class="w"> </span><span class="s2">&quot;{{ georchestra_versions.georchestra_repository }}&quot;</span>

<span class="w">   </span>georchestra:
<span class="w">      </span>fqdn:<span class="w"> </span>georchestra.ole.re
<span class="w">      </span>max_body_size:<span class="w"> </span>100M
<span class="w">      </span>ign_api_key:<span class="w"> </span>luvs4p9c4yq5ewfwqcqgm83f<span class="w"> </span><span class="c1"># invalid key only used in sviewer</span>
<span class="w">      </span>db:
<span class="w">      </span>name:<span class="w"> </span>georchestra
<span class="w">      </span>user:<span class="w"> </span>georchestra
<span class="w">      </span>pass:<span class="w"> </span>georchestra
<span class="w">      </span>datadir:
<span class="w">      </span>path:<span class="w"> </span>/etc/georchestra
<span class="w">      </span>gitrepo:<span class="w"> </span>https://github.com/georchestra/datadir
<span class="w">      </span>gitversion:<span class="w"> </span><span class="s2">&quot;{{ georchestra_versions.datadir }}&quot;</span>
<span class="w">      </span>debian:
<span class="w">      </span>repo:<span class="w"> </span><span class="s2">&quot;{{ georchestra_versions.debian_repository_url }}&quot;</span>
<span class="w">      </span>key:<span class="w"> </span>https://packages.georchestra.org/debian/landry%40georchestra.org.gpg.pubkey
<span class="w">   </span>geonetwork:
<span class="w">      </span>db:
<span class="w">      </span>schema:<span class="w"> </span>geonetwork
<span class="w">      </span>datadir:
<span class="w">      </span>path:<span class="w"> </span>/srv/data/geonetwork/
<span class="w">      </span>gitrepo:<span class="w"> </span>https://github.com/georchestra/geonetwork_minimal_datadir
<span class="w">      </span>gitversion:<span class="w"> </span><span class="s2">&quot;{{ georchestra_versions.geonetwork_datadir }}&quot;</span>
<span class="w">   </span>geoserver:
<span class="w">      </span>privileged:
<span class="w">      </span>user:<span class="w"> </span>geoserver_privileged_user
<span class="w">      </span>pass:<span class="w"> </span>gerlsSnFd6SmM
<span class="w">      </span>datadir:
<span class="w">      </span>path:<span class="w"> </span>/srv/data/geoserver/
<span class="w">      </span>gitrepo:<span class="w"> </span>https://github.com/georchestra/geoserver_minimal_datadir
<span class="w">      </span>gitversion:<span class="w"> </span><span class="s2">&quot;{{ georchestra_versions.geoserver_datadir }}&quot;</span>
<span class="w">      </span>wms_srslist:
<span class="w">      </span>-<span class="w"> </span><span class="m">2154</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">3857</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">3942</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">3943</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">3944</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">3945</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">3946</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">3947</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">3948</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">3949</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">3950</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">4171</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">4258</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">4326</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">23030</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">23031</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">23032</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">32630</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">32631</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">32632</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">4171</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">4271</span>
<span class="w">      </span>-<span class="w"> </span><span class="m">3758</span>
<span class="w">   </span>geowebcache_datadir:<span class="w"> </span>/srv/data/geowebcache/
<span class="w">   </span>tomcat_keystore_pass:<span class="w"> </span>tomcatkstp
<span class="w">   </span>tomcat_basedir:<span class="w"> </span>/srv/tomcat
<span class="w">   </span>system_locale:<span class="w"> </span>en_US.UTF-8
<span class="w">   </span>logs_basedir:<span class="w"> </span>/srv/log
<span class="w">   </span>force_https:<span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="c1"># set to false if running behind a reverse proxy that does SSL</span>
<span class="w">   </span><span class="c1"># if running behind a reverse proxy, uncomment/fill so that you get the real client ip in accesslogs</span>
<span class="w">   </span><span class="c1">#reverse_proxy_real_ip: 10.0.0.1</span>
<span class="w">   </span><span class="c1">#reverse_proxy_real_ip_header: X-Forwarded-For</span>
<span class="w">   </span>console_adminemail:<span class="w"> </span>admin@example.org
<span class="w">   </span>console_captcha:
<span class="w">      </span>privateKey:<span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">      </span>publicKey:<span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">   </span>tomcat_instances:
<span class="w">      </span>proxycas:
<span class="w">      </span>port:<span class="w"> </span><span class="m">8180</span>
<span class="w">      </span>control_port:<span class="w"> </span><span class="m">8105</span>
<span class="w">      </span>xms:<span class="w"> </span>256m
<span class="w">      </span>xmx:<span class="w"> </span>512m
<span class="w">      </span>georchestra:
<span class="w">      </span>port:<span class="w"> </span><span class="m">8280</span>
<span class="w">      </span>control_port:<span class="w"> </span><span class="m">8205</span>
<span class="w">      </span>xms:<span class="w"> </span>1G
<span class="w">      </span>xmx:<span class="w"> </span>2G
<span class="w">      </span>geoserver:
<span class="w">      </span>port:<span class="w"> </span><span class="m">8380</span>
<span class="w">      </span>control_port:<span class="w"> </span><span class="m">8305</span>
<span class="w">      </span>xms:<span class="w"> </span>1G
<span class="w">      </span>xmx:<span class="w"> </span>1G
<span class="w">   </span>georchestra_wars:
<span class="w">      </span>analytics:
<span class="w">      </span>pkg:<span class="w"> </span>georchestra-analytics
<span class="w">      </span>tomcat:<span class="w"> </span>georchestra
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>cas:
<span class="w">      </span>pkg:<span class="w"> </span>georchestra-cas
<span class="w">      </span>tomcat:<span class="w"> </span>proxycas
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>geonetwork:
<span class="w">      </span>pkg:<span class="w"> </span>georchestra-geonetwork
<span class="w">      </span>tomcat:<span class="w"> </span>georchestra
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span><span class="c1"># mapstore: # using a github action artifact</span>
<span class="w">      </span><span class="c1">#   url: https://api.github.com/repos/{{ mapstore.repo }}/actions/artifacts/{{ mapstore.artifact_id }}/zip</span>
<span class="w">      </span><span class="c1">#   tomcat: georchestra</span>
<span class="w">      </span><span class="c1">#   artifact_sha256: &quot;{{ mapstore.artifact_sha256 }}&quot;</span>
<span class="w">      </span><span class="c1">#   enabled: &quot;{{ mapstore.enabled }}&quot;</span>
<span class="w">      </span>mapstore:<span class="w"> </span><span class="c1"># using the package from packages.georchestra.org</span>
<span class="w">      </span>pkg:<span class="w"> </span>georchestra-mapstore
<span class="w">      </span>tomcat:<span class="w"> </span>georchestra
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>geoserver:
<span class="w">      </span>pkg:<span class="w"> </span>georchestra-geoserver
<span class="w">      </span>tomcat:<span class="w"> </span>geoserver
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>geowebcache:
<span class="w">      </span>pkg:<span class="w"> </span>georchestra-geowebcache
<span class="w">      </span>tomcat:<span class="w"> </span>georchestra
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>import:
<span class="w">      </span>pkg:<span class="w"> </span>georchestra-datafeeder-ui
<span class="w">      </span>tomcat:<span class="w"> </span>georchestra
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>header:
<span class="w">      </span>pkg:<span class="w"> </span>georchestra-header
<span class="w">      </span>tomcat:<span class="w"> </span>georchestra
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>console:
<span class="w">      </span>pkg:<span class="w"> </span>georchestra-console
<span class="w">      </span>tomcat:<span class="w"> </span>georchestra
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>cadastrapp:
<span class="w">      </span>pkg:<span class="w"> </span>georchestra-cadastrapp
<span class="w">      </span>tomcat:<span class="w"> </span>georchestra
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">false</span>
<span class="w">      </span>ROOT:
<span class="w">      </span>pkg:<span class="w"> </span>georchestra-security-proxy
<span class="w">      </span>tomcat:<span class="w"> </span>proxycas
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">   </span>datafeeder:
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>port:<span class="w"> </span><span class="m">8480</span>
<span class="w">   </span><span class="c1"># not yet, doesnt work standalone ?</span>
<span class="w">   </span><span class="c1">#    cas:</span>
<span class="w">   </span><span class="c1">#      pkg: georchestra-cas</span>
<span class="w">   </span><span class="c1">#      enabled: true</span>
<span class="w">   </span><span class="c1">#      port: 8980</span>
<span class="w">   </span>gn_cloud_searching:
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>port:<span class="w"> </span><span class="m">8580</span>
<span class="w">      </span>url:<span class="w"> </span>https://packages.georchestra.org/bot/wars/geonetwork-microservices/searching.jar
<span class="w">   </span>gn_ogc_api_records:
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>port:<span class="w"> </span><span class="m">8880</span>
<span class="w">      </span>url:<span class="w"> </span>https://packages.georchestra.org/bot/wars/geonetwork-microservices/gn-ogc-api-records.jar
<span class="w">   </span>datahub:
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">      </span>url:<span class="w"> </span>https://packages.georchestra.org/bot/datahub/datahub.zip
<span class="w">      </span>default_api_url:<span class="w"> </span>/geonetwork/srv/api<span class="w"> </span><span class="c1"># could be set to any other GeoNetwork catalogue, even remote if CORS allows it</span>
<span class="w">   </span>mviewer:
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">false</span>
<span class="w">      </span>port:<span class="w"> </span><span class="m">8680</span>
<span class="w">      </span>gitrepo:<span class="w"> </span>https://github.com/mviewer/mviewer
<span class="w">      </span>gitversion:<span class="w"> </span>master
<span class="w">   </span>mviewerstudio:
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">false</span>
<span class="w">      </span>port:<span class="w"> </span><span class="m">8780</span>
<span class="w">      </span>gitrepo:<span class="w"> </span>https://github.com/mviewer/mviewerstudio
<span class="w">      </span>gitversion:<span class="w"> </span>master
<span class="w">   </span>gateway:
<span class="w">      </span>enabled:<span class="w"> </span><span class="nb">false</span>
<span class="w">      </span>port:<span class="w"> </span><span class="m">8980</span>
tasks:
<span class="w">   </span>-<span class="w"> </span>name:<span class="w"> </span>reconfigure<span class="w"> </span>Kibana<span class="w"> </span>after<span class="w"> </span>geerlingguy.kibana
<span class="w">      </span>copy:
<span class="w">      </span>src:<span class="w"> </span>resources/kibana.yml
<span class="w">      </span>dest:<span class="w"> </span>/etc/kibana/kibana.yml
<span class="w">      </span>owner:<span class="w"> </span>root
<span class="w">      </span>group:<span class="w"> </span>root
<span class="w">      </span>mode:<span class="w"> </span><span class="s2">&quot;0644&quot;</span>
<span class="w">      </span>notify:<span class="w"> </span>restart<span class="w"> </span>kibana

handlers:
<span class="w">   </span>-<span class="w"> </span>name:<span class="w"> </span>restart<span class="w"> </span>kibana
<span class="w">      </span>service:<span class="w"> </span><span class="nv">name</span><span class="o">=</span>kibana<span class="w"> </span><span class="nv">state</span><span class="o">=</span>restarted
</pre></div>
</div>
<p>Si vous voulez que les modifications dans ce fichiers s’execute il faut relancer l’installation dans le repo du git cloné:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>ansible-playbook<span class="w"> </span>playbooks/georchestra.yml
</pre></div>
</div>
</section>
<section id="base-de-donnee">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Base de donnée</a><a class="headerlink" href="#base-de-donnee" title="Lien vers cette rubrique"></a></h2>
<p>La base de donnée est accessible avec psql :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>psql<span class="w"> </span>-U<span class="w"> </span>georchestra<span class="w"> </span>-h<span class="w"> </span>localhost
</pre></div>
</div>
<p>Elle stocke les données dans différents schémas. Il n’est pas nécéssaire de l’utiliser.</p>
</section>
<section id="scripts-de-personnalisation">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Scripts de personnalisation</a><a class="headerlink" href="#scripts-de-personnalisation" title="Lien vers cette rubrique"></a></h2>
<p>Voici les scripts commentés qui sont facile à comprendre et modifier selon les besoins:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># Mise à jour du fichier de propriétés pour le changement de langue</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de &#39;language=en&#39; par &#39;language=fr&#39; dans le fichier de propriétés...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/language=en/language=fr/&#39;</span><span class="w"> </span>/etc/georchestra/default.properties
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour du fichier de propriétés terminée.&quot;</span>

<span class="c1"># Mise à jour du fichier de propriétés pour le changement d&#39;URL du logo</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de l&#39;URL du logo dans le fichier de propriétés...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s|logoUrl=https://www.georchestra.org/public/georchestra-logo.svg|logoUrl=https://raw.githubusercontent.com/ToffoluttiVittorio/ansible/master/Configuration/georchestra-logo.svg|&#39;</span><span class="w"> </span>/etc/georchestra/default.properties
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour de l&#39;URL du logo terminée.&quot;</span>

<span class="c1"># Remplacement de l&#39;URL de la feuille de style commentée dans le fichier de propriétés</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de l&#39;URL de la feuille de style commentée dans le fichier de propriétés...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s|# georchestraStylesheet=http://my-domain-name/stylesheet.css|georchestraStylesheet=./stylesheet.css|&#39;</span><span class="w"> </span>/etc/georchestra/default.properties
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour de l&#39;URL de la feuille de style terminée.&quot;</span>

<span class="c1"># Activation des analytics dans le fichier de propriétés</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Activation des analytics dans le fichier de propriétés...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/analyticsEnabled=false/analyticsEnabled=true/&#39;</span><span class="w"> </span>/etc/georchestra/default.properties
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Activation des analytics terminée.&quot;</span>

<span class="c1"># Mise à jour de la timezone dans le fichier de propriétés</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de la timezone dans le fichier de propriétés...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s|#localTimezone=Europe/Paris|localTimezone=Indian/Reunion|&#39;</span><span class="w"> </span>/etc/georchestra/analytics/analytics.properties
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour de la timezone terminée.&quot;</span>

<span class="c1"># Traduction des valeurs de orgTypeValues dans le fichier de propriétés</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement des valeurs de orgTypeValues par leur traduction en français...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/orgTypeValues=Association,Company,NGO,Individual,Other/orgTypeValues=Association,Entreprise,ONG,Individu,Autre/&#39;</span><span class="w"> </span>/etc/georchestra/console/console.properties
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Traduction des valeurs de orgTypeValues terminée.&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># Vérifier si la nouvelle projection existe déjà dans le fichier JSON et ajouter si elle n&#39;existe pas</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Vérification et ajout de la nouvelle entrée à la liste &#39;projections&#39; dans le fichier JSON...&quot;</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s1">&#39;&quot;value&quot;: &quot;EPSG:2975&quot;&#39;</span><span class="w"> </span>/etc/georchestra/datafeeder/frontend-config.json<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/&quot;projections&quot;: \[/a \</span>
<span class="s1">   {\</span>
<span class="s1">      &quot;label&quot;: &quot;RGR92 / UTM zone 40S&quot;,\</span>
<span class="s1">      &quot;value&quot;: &quot;EPSG:2975&quot;\</span>
<span class="s1">   },&#39;</span><span class="w"> </span>/etc/georchestra/datafeeder/frontend-config.json
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Nouvelle entrée ajoutée à la liste &#39;projections&#39;.&quot;</span>
<span class="k">else</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;La projection &#39;EPSG:2975&#39; existe déjà dans la liste &#39;projections&#39;.&quot;</span>
<span class="k">fi</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour du fichier JSON terminée.&quot;</span>

<span class="c1"># Remplacement des valeurs dans le fichier XML</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de &#39;codeListValue=\&quot;eng\&quot;&#39; par &#39;codeListValue=\&quot;fre\&quot;&#39; dans le fichier XML de datafeeder&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/codeListValue=&quot;eng&quot;/codeListValue=&quot;fre&quot;/g&#39;</span><span class="w"> </span>/etc/georchestra/datafeeder/metadata_template.xml
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement dans le fichier XML terminé.&quot;</span>

<span class="c1"># Suppression du fichier header_bg.web et copie du fichier header_bg.webp</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Suppression du fichier header_bg.web et copie du fichier header_bg.webp...&quot;</span>
rm<span class="w"> </span>-f<span class="w"> </span>/etc/georchestra/datahub/assets/img/header_bg.web
cp<span class="w"> </span>header_bg.webp<span class="w"> </span>/etc/georchestra/datahub/assets/img/
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Fichier header_bg.web remplacé par header_bg.webp.&quot;</span>

<span class="c1"># Remplacement dans le fichier TOML pour les langues</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de &#39;# languages = [&#39;en&#39;, &#39;fr&#39;, &#39;de&#39;]&#39; par &#39;languages = [&#39;en&#39;, &#39;fr&#39;, &#39;de&#39;]&#39; dans le fichier TOML...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s/# languages = \[&#39;en&#39;, &#39;fr&#39;, &#39;de&#39;\]/languages = \[&#39;en&#39;, &#39;fr&#39;, &#39;de&#39;\]/&quot;</span><span class="w"> </span>/etc/georchestra/datahub/conf/default.toml
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement dans le fichier TOML terminé.&quot;</span>

<span class="c1"># Remplacement de la couleur primaire dans le fichier TOML</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de &#39;primary_color = \&quot;#85127e\&quot;&#39; par &#39;primary_color = \&quot;#0a397f\&quot;&#39; dans le fichier TOML...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/primary_color = &quot;#85127e&quot;/primary_color = &quot;#0a397f&quot;/&#39;</span><span class="w"> </span>/etc/georchestra/datahub/conf/default.toml
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de la couleur primaire dans le fichier TOML terminé.&quot;</span>

<span class="c1"># Remplacement de la couleur secondaire dans le fichier TOML</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de &#39;secondary_color = \&quot;#1b1f3b\&quot;&#39; par &#39;secondary_color = \&quot;#225ea8\&quot;&#39; dans le fichier TOML...&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/secondary_color = &quot;#1b1f3b&quot;/secondary_color = &quot;#225ea8&quot;/&#39;</span><span class="w"> </span>/etc/georchestra/datahub/conf/default.toml
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de la couleur secondaire dans le fichier TOML terminé.&quot;</span>

<span class="c1"># Suppression du commentaire et activation de la ligne dans le fichier TOML</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement de &#39;# enabled = true&#39; par &#39;enabled = true&#39; pour activer le % de qualité de métadonnée&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/# enabled = true/enabled = true/&#39;</span><span class="w"> </span>/etc/georchestra/datahub/conf/default.toml
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Activation de la ligne dans le fichier TOML terminée.&quot;</span>

<span class="c1"># Suppression des sections &#39;en&#39; et &#39;it&#39; dans le fichier JSON</span>
<span class="c1">#echo &quot;Suppression des sections &#39;en&#39; et &#39;it&#39; dans le fichier JSON...&quot;</span>
<span class="c1">#sed -i &#39;/&quot;en&quot;: {/,/},/d&#39; /etc/georchestra/mapstore/configs/localConfig.json</span>
<span class="c1">#sed -i &#39;/&quot;it&quot;: {/,/},/d&#39; /etc/georchestra/mapstore/configs/localConfig.json</span>
<span class="c1">#echo &quot;Suppression des sections terminée.&quot;</span>

<span class="c1"># Vérifier si la nouvelle projection existe déjà dans la section &#39;projectionDefs&#39; et ajouter si elle n&#39;existe pas</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Vérification et ajout de la nouvelle projection à la section &#39;projectionDefs&#39;...&quot;</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s1">&#39;&quot;code&quot;: &quot;EPSG:2975&quot;&#39;</span><span class="w"> </span>/etc/georchestra/mapstore/configs/localConfig.json<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/&quot;projectionDefs&quot;: \[/a \</span>
<span class="s1">      &quot;code&quot;: &quot;EPSG:2975&quot;,\</span>
<span class="s1">      &quot;def&quot;: &quot;+proj=lcc +lat_1=48.5 +lat_2=49.5 +lat_0=48.0 +lon_0=-123.0 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs&quot;,\</span>
<span class="s1">      &quot;extent&quot;: [-600000, 1500000, 1200000, 5000000],\</span>
<span class="s1">      &quot;worldExtent&quot;: [-130, 24, -66, 49]\</span>
<span class="s1">   },{&#39;</span><span class="w"> </span>/etc/georchestra/mapstore/configs/localConfig.json
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Nouvelle projection ajoutée à la section &#39;projectionDefs&#39;.&quot;</span>
<span class="k">else</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;La projection &#39;EPSG:2975&#39; existe déjà dans la section &#39;projectionDefs&#39;.&quot;</span>
<span class="k">fi</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour du fichier terminé.&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># Copier le fichier stylesheet.css dans les répertoires de destination</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Copie du fichier stylesheet.css dans les répertoires de destination...&quot;</span>

<span class="c1"># Répertoires de destination</span>
<span class="nv">DESTINATIONS</span><span class="o">=(</span>
<span class="s2">&quot;/var/www/georchestra/htdocs/datahub/&quot;</span>
<span class="s2">&quot;/srv/tomcat/georchestra/webapps/analytics/&quot;</span>
<span class="s2">&quot;/srv/tomcat/proxycas/webapps/cas/WEB-INF/classes/static/&quot;</span>
<span class="s2">&quot;/srv/tomcat/georchestra/webapps/console/account/&quot;</span>
<span class="o">)</span>

<span class="c1"># Boucle pour copier le fichier dans chaque répertoire</span>
<span class="k">for</span><span class="w"> </span>DEST<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DESTINATIONS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
cp<span class="w"> </span>./stylesheet.css<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DEST</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Fichier stylesheet.css copié avec succès dans </span><span class="nv">$DEST</span><span class="s2">.&quot;</span>
<span class="k">done</span>

<span class="c1"># Remplacement des couleurs dans le fichier CSS</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement des couleurs dans le fichier cas.css&quot;</span>
<span class="c1"># Remplacer #540069 par #0a397f</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#540069/#0a397f/g&#39;</span><span class="w"> </span><span class="s2">&quot;/srv/tomcat/proxycas/webapps/cas/WEB-INF/classes/static/themes/georchestra/css/cas.css&quot;</span>
<span class="c1"># Remplacer #720e9e par #0a397f</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#720e9e/#0a397f/g&#39;</span><span class="w"> </span><span class="s2">&quot;/srv/tomcat/proxycas/webapps/cas/WEB-INF/classes/static/themes/georchestra/css/cas.css&quot;</span>
<span class="c1"># Remplacer #845490 par #225ea8</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#845490/#225ea8/g&#39;</span><span class="w"> </span><span class="s2">&quot;/srv/tomcat/proxycas/webapps/cas/WEB-INF/classes/static/themes/georchestra/css/cas.css&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement des couleurs terminé.&quot;</span>

<span class="c1"># Remplacement des valeurs de langue dans le fichier JSP</span>
<span class="c1">#echo &quot;Remplacement des valeurs de langue dans le fichier JSP...&quot;</span>

<span class="c1"># Remplacer lang = forcedLang par lang = &quot;fr&quot;</span>
<span class="c1">#sed -i &#39;s/lang = forcedLang/lang = &quot;fr&quot;/g&#39; &quot;/srv/tomcat/georchestra/webapps/analytics/WEB-INF/jsp/index.jsp&quot;</span>

<span class="c1"># Remplacer lang = detectedLanguage par lang = &quot;fr&quot;</span>
<span class="c1">#sed -i &#39;s/lang = detectedLanguage/lang = &quot;fr&quot;/g&#39; &quot;/srv/tomcat/georchestra/webapps/analytics/WEB-INF/jsp/index.jsp&quot;</span>

<span class="c1">#echo &quot;Remplacement des valeurs de langue terminé.&quot;</span>

<span class="c1"># Changement de couleurs dans le css de mapstore</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Changement de couleurs dans le css de mapstore&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#85127e/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Changement de couleurs dans le css de mapstore terminé.&quot;</span>


<span class="c1"># Changement du header de datahub</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Changement du header de datahub&quot;</span>
<span class="c1"># Chemin vers votre fichier HTML</span>
<span class="nv">file</span><span class="o">=</span><span class="s2">&quot;/var/www/georchestra/htdocs/datahub/index.html&quot;</span>

<span class="c1"># Attributs à vérifier</span>
<span class="nv">attr_check</span><span class="o">=</span><span class="s2">&quot;lang=&#39;fr&#39; stylesheet=&#39;./stylesheet.css&#39; logo-url=&#39;./georchestra-logo.svg&#39;&quot;</span>

<span class="c1"># Vérifier si la balise &lt;geor-header&gt; avec les attributs existe déjà</span>
<span class="k">if</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;&lt;geor-header.*</span><span class="nv">$attr_check</span><span class="s2">.*&gt;&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Les attributs existent déjà dans la balise &lt;geor-header&gt;.&quot;</span>
<span class="k">else</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Les attributs n&#39;existent pas. Ajout en cours...&quot;</span>
<span class="c1"># Commande sed pour ajouter les attributs</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s/&lt;geor-header active-app=&#39;datahub&#39; legacy-header=&#39;false&#39; legacy-url=&#39;\/header\/&#39; style=&#39;height:90px&#39;&gt;/&lt;geor-header active-app=&#39;datahub&#39; legacy-header=&#39;false&#39; legacy-url=&#39;\/header\/&#39; lang=&#39;fr&#39; stylesheet=&#39;.\/stylesheet.css&#39; logo-url=&#39;.\/georchestra-logo.svg&#39; style=&#39;height:90px&#39;&gt;/g&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Les attributs ont été ajoutés.&quot;</span>
<span class="k">fi</span>

<span class="c1">#Ajout du logo pour le header de datahub</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Ajout du logo pour le header de datahub&quot;</span>
cp<span class="w"> </span>./georchestra-logo.svg<span class="w"> </span>/var/www/georchestra/htdocs/datahub/
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Ajout du logo pour le header de mapstore terminé&quot;</span>

<span class="c1">#Changement du favicon</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remplacement du favicon&quot;</span>
rm<span class="w"> </span>/var/www/georchestra/htdocs/favicon.ico
cp<span class="w"> </span>./favicon.ico<span class="w"> </span>/var/www/georchestra/htdocs/favicon.ico
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Ramplacement du favicon&quot;</span>

<span class="c1">#Changement des couleurs de mapstore</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Changement des couleurs pour mapstore&quot;</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#6f0f69/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#ed76e5/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#df1ed3/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#708/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#d97fff/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#6e296a/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#800080/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#b218a9/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#610/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#d5c/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#8e1387/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#7c1175/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#42093e/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#150314/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#390836/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#4f0b46/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#680c63/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#73106d/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/#73106d/#0a397f/g&#39;</span><span class="w"> </span>/srv/tomcat/georchestra/webapps/mapstore/dist/themes/default.css
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Changement des couleur terminés&quot;</span>

<span class="c1"># Copie du favicon.png dans le repertoire de geonetwork</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Copie du favicon.png dans le repertoire de geonetwork&quot;</span>
cp<span class="w"> </span>./favicon.png<span class="w"> </span>/srv/data/geonetwork/data/resources/images/logos/
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Copie du favicon.png dans le repertoire de geonetwork terminé&quot;</span>

<span class="c1"># Vérification et ajout des redirections</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Vérification des redirections&quot;</span>

<span class="c1"># Vérifiez si le pattern existe déjà dans le fichier</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s1">&#39;Redirect the stylesheet&#39;</span><span class="w"> </span>/etc/nginx/sites-available/georchestra<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span><span class="c1"># Ajouter les redirections juste avant la dernière occurrence du pattern spécifique</span>
<span class="w">   </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/# redirect default to datahub/i \</span>
<span class="s1">      # Redirect the stylesheet.css url of geoserver to something known\</span>
<span class="s1">      location /geoserver/web/wicket/bookmarkable/stylesheet.css {\</span>
<span class="s1">            alias /etc/georchestra/stylesheet.css;\</span>
<span class="s1">      }\</span>
<span class="s1">      # Same for another url\</span>
<span class="s1">      location /geoserver/web/stylesheet.css {\</span>
<span class="s1">            alias /etc/georchestra/stylesheet.css;\</span>
<span class="s1">      }\</span>
<span class="s1">      # Redirect the stylesheet.css url of geonetwork to something known\</span>
<span class="s1">      location ~ ^/geonetwork/.*/.*/stylesheet\\.css$ {\</span>
<span class="s1">            alias /etc/georchestra/stylesheet.css;\</span>
<span class="s1">      }\</span>
<span class="s1">      # Redirect the stylesheet.css of the console admin account url to something known\</span>
<span class="s1">      location /console/account/stylesheet.css {\</span>
<span class="s1">            alias /etc/georchestra/stylesheet.css;\</span>
<span class="s1">      }\</span>
<span class="s1">      # Redirect the stylesheet.css of the console admin manager url to something known\</span>
<span class="s1">      location /console/manager/stylesheet.css {\</span>
<span class="s1">            alias /etc/georchestra/stylesheet.css;\</span>
<span class="s1">      }\</span>
<span class="s1">      &#39;</span><span class="w"> </span>/etc/nginx/sites-available/georchestra

<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Les redirections ont été ajoutées&quot;</span>
<span class="k">else</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Les redirections ont déjà été ajoutées&quot;</span>
<span class="k">fi</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mise à jour des redirections terminée.&quot;</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="maj.html" class="btn btn-neutral float-right" title="Mise à jour" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2024, Vittorio Toffolutti.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>